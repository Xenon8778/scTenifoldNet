library(Matrix)
WT <- readMM('wtAT1.mtx')
rownames(WT) <- readLines('genes_wtAT1.txt')
colnames(WT) <- readLines('barcodes_wtAT1.txt')

KO <- readMM('koAT1.mtx')
rownames(KO) <- readLines('genes_koAT1.txt')
colnames(KO) <- readLines('barcodes_koAT1.txt')

source('https://raw.githubusercontent.com/dosorio/utilities/master/singleCell/scQC.R')
WT <- scQC(WT)
KO <- scQC(KO)

library(Seurat)
library(harmony)
WT <- CreateSeuratObject(WT, project = 'WT')
KO <- CreateSeuratObject(KO, project = 'KO')

ALL <- merge(WT,KO)
ALL <- NormalizeData(ALL)
ALL <- ScaleData(ALL)
ALL <- FindVariableFeatures(ALL)
ALL <- RunPCA(ALL)
ALL <- RunHarmony(ALL, group.by.vars = 'orig.ident')
ALL <- RunTSNE(ALL, reduction = 'harmony')
ALL <- RunUMAP(ALL, dims = 1:20, reduction = 'harmony')
TSNEPlot(ALL)
UMAPPlot(ALL)
